<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Intelligence - Big Bola</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/PJSBFV7L/panel.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Tus estilos CSS existentes aquí */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a3a8f 0%, #152c6e 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        .welcome-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo {
            max-width: 250px;
            margin: 0 auto 20px;
            display: block;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        p {
            font-size: 18px;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .countdown {
            font-size: 48px;
            font-weight: bold;
            margin: 30px 0;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .btn {
            background: linear-gradient(to bottom, #FFD700, #FF8C00);
            color: #152c6e;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, #FFE600, #FF9E00);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .btn .countdown-badge {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        .dashboard-container {
            display: none;
        }
        
        /* Estilos específicos para móviles/tabletas - MODIFICADOS */
        .mobile-dashboard-container {
            display: none;
            width: 100vw;
            height: 100vh;
            background: #f5f5f5;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        
        .mobile-floating-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(26, 58, 143, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .mobile-floating-toggle:hover {
            background: rgba(26, 58, 143, 0.9);
            transform: scale(1.05);
        }
        
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: #152c6e;
            z-index: 1002;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }
        
        .mobile-sidebar.active {
            left: 0;
        }
        
        .mobile-sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
        }
        
        .mobile-sidebar-overlay.active {
            display: block;
        }
        
        .mobile-sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }
        
        .mobile-sidebar-logo {
            height: 60px;
            width: auto;
            margin-bottom: 15px;
        }
        
        .mobile-sidebar-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-align: center;
            line-height: 1.2;
        }
        
        .mobile-menu-section {
            color: #FFD700;
            font-weight: bold;
            margin: 20px 0 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-size: 16px;
        }
        
        .mobile-menu-item {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            border-radius: 5px;
            text-align: left;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 15px;
        }
        
        .mobile-menu-item:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .mobile-menu-item.active {
            background: rgba(255,215,0,0.3);
            border-left: 3px solid #FFD700;
        }
        
        .mobile-menu-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .mobile-sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .mobile-exit-btn {
            display: block;
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 0, 0, 0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            transition: background 0.3s;
            text-align: center;
        }
        
        .mobile-exit-btn:hover {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .mobile-iframe-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            transition: left 0.3s ease;
        }
        
        .mobile-iframe-container.sidebar-open {
            left: 280px;
            width: calc(100% - 280px);
        }
        
        .mobile-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Estilos para el login */
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .user-info {
            margin-top: 15px;
            font-size: 14px;
            color: #FFD700;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .status-success {
            background: rgba(0, 255, 0, 0.2);
            color: #90EE90;
        }
        
        .status-error {
            background: rgba(255, 0, 0, 0.2);
            color: #FFB6C1;
        }
        
        .status-loading {
            background: rgba(255, 255, 0, 0.2);
            color: #FFD700;
        }

        /* Estilos para el mensaje de clic derecho deshabilitado */
        .context-menu-message {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 10000;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 600px) {
            .welcome-container {
                padding: 25px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            p {
                font-size: 16px;
            }
            
            .countdown {
                font-size: 36px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 16px;
            }
            
            .btn .countdown-badge {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }
            
            .mobile-floating-toggle {
                width: 45px;
                height: 45px;
                font-size: 18px;
                top: 15px;
                left: 15px;
            }
            
            .mobile-sidebar {
                width: 260px;
            }
            
            .mobile-iframe-container.sidebar-open {
                left: 260px;
                width: calc(100% - 260px);
            }
            
            .login-container {
                padding: 25px;
            }
        }
        
        /* Ocultar welcome en móviles y mostrar dashboard móvil */
        @media (max-width: 1024px) {
            .welcome-container {
                display: none !important;
            }
            
            .mobile-dashboard-container {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- Mensaje para clic derecho deshabilitado -->
    <div class="context-menu-message" id="contextMenuMessage">Menú contextual deshabilitado</div>

    <!-- Contenedor de login -->
    <div class="login-container" id="loginContainer">
        <img src="https://i.postimg.cc/hGqNYsNp/Isotipo-Perfiles-Marmol01-Photoroom.png" alt="Big Bola Casinos" class="logo">
        <h1>Centro de Business Intelligence</h1>
        <p>Ingresa con tu correo corporativo</p>
        
        <div class="login-form">
            <div class="form-group">
                <label for="email">Correo electrónico:</label>
                <input type="email" id="email" placeholder="usuario@bigbola.com" required>
            </div>
            <button class="btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Ingresar
            </button>
        </div>
        
        <div class="status-message" id="statusMessage" style="display: none;"></div>
        
        <div class="user-info" id="userInfo" style="display: none;">
            <p>Bienvenido: <span id="userEmail"></span></p>
            <p>Dashboards disponibles: <span id="dashboardsCount"></span></p>
        </div>
    </div>

    <!-- Versión PC/Laptop (original) -->
    <div class="welcome-container" id="welcomeContainer" style="display: none;">
        <img src="https://i.postimg.cc/hGqNYsNp/Isotipo-Perfiles-Marmol01-Photoroom.png" alt="Big Bola Casinos" class="logo">
        <h1>Centro de Business Intelligence</h1>
        <p>Tecnologías de la Información - Big Bola Casinos</p>
        
        <div class="countdown" id="countdown">5</div>
        
        <p>El Centro de BI se abrirá en pantalla completa automáticamente</p>
        
        <div>
            <button class="btn" id="openBtn">
                <i class="fas fa-play"></i> Abrir Ahora
            </button>
        </div>
    </div>

    <!-- Versión Móvil/Tableta - MODIFICADA -->
    <div class="mobile-dashboard-container" id="mobileDashboardContainer">
        <button class="mobile-floating-toggle" id="mobileToggleBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="mobile-sidebar-overlay" id="mobileOverlay"></div>
        
        <div class="mobile-sidebar" id="mobileSidebar">
            <div class="mobile-sidebar-header">
                <img src="https://i.postimg.cc/hGqNYsNp/Isotipo-Perfiles-Marmol01-Photoroom.png" alt="Big Bola Casinos" class="mobile-sidebar-logo">
                <div class="mobile-sidebar-title">
                    <div>Centro de</div>
                    <div>Business Intelligence</div>
                </div>
                <div class="user-info" style="margin-top: 10px; font-size: 12px;">
                    Usuario: <span id="mobileUserEmail"></span>
                </div>
            </div>
            
            <!-- Los elementos del menú se generarán dinámicamente -->
        </div>
        
        <div class="mobile-iframe-container" id="mobileIframeContainer">
            <iframe class="mobile-iframe" id="mobileIframe"></iframe>
        </div>
    </div>

    <script>
        // Función para deshabilitar clic derecho y mostrar mensaje
        function disableRightClick() {
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showContextMenuMessage();
            });
        }

        // Función para mostrar mensaje de clic derecho deshabilitado
        function showContextMenuMessage() {
            const message = document.getElementById('contextMenuMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 2000);
        }

        // Deshabilitar clic derecho inmediatamente al cargar la página
        disableRightClick();

        // Mapeo de dashboards a URLs
        const dashboardUrls = {
            "principal": "https://app.powerbi.com/reportEmbed?reportId=9bd044c3-981b-4a9a-914a-b7bf130dae59&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "adt": "https://app.powerbi.com/reportEmbed?reportId=1149b379-aad5-4876-bfe6-c325dc89308f&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "auditoria": "https://app.powerbi.com/reportEmbed?reportId=a78289b5-2543-4104-aff7-96e30ef79b58&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "bigplayers": "https://app.powerbi.com/reportEmbed?reportId=ff7ca313-9e8f-4513-9bcd-df9182f2464a&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "desempeno": "https://app.powerbi.com/reportEmbed?reportId=28c07103-a77e-42f4-a9ca-7d9345b48131&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "inventario": "https://app.powerbi.com/reportEmbed?reportId=4fe689c1-3fa7-4632-8367-4b7a7abc492c&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "promociones": "https://app.powerbi.com/reportEmbed?reportId=7253b2c9-12b1-4a8a-b555-2fef1d62e1b3&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "proyectos": "https://app.powerbi.com/reportEmbed?reportId=c2e5834e-4e3d-418c-a9dc-43e33d79a62e&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "rtp": "https://app.powerbi.com/reportEmbed?reportId=01ac285e-618f-43de-be89-d62b1a46374c&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c",
            "diccionario": "https://app.powerbi.com/reportEmbed?reportId=95918a25-c06b-411a-a346-f462b03e557b&autoAuth=true&ctid=b19d1a80-fff1-4a7e-b9ce-93f694e7b65c"
        };

        // Mapeo de nombres de dashboards
        const dashboardNames = {
            "principal": "Principal",
            "adt": "ADT",
            "auditoria": "Auditoría de Salas",
            "bigplayers": "Big Player's",
            "desempeno": "Desempeño de Máquinas",
            "inventario": "Inventario TI",
            "promociones": "Promociones",
            "proyectos": "Proyectos BI",
            "rtp": "RTP",
            "diccionario": "Diccionario KPI's"
        };

        // Mapeo de íconos para dashboards
        const dashboardIcons = {
            "principal": "fas fa-house",
            "adt": "fas fa-chart-line",
            "auditoria": "fas fa-search",
            "bigplayers": "fas fa-gem",
            "desempeno": "fas fa-tachometer-alt",
            "inventario": "fas fa-desktop",
            "promociones": "fas fa-gift",
            "proyectos": "fas fa-project-diagram",
            "rtp": "fas fa-coins",
            "diccionario": "fas fa-book"
        };

        // Variables globales para almacenar permisos y usuario actual
        let permissionsData = null;
        let currentUser = null;
        let currentUserPermissions = [];

        // Permisos por defecto que se usarán si falla la carga del JSON
        const defaultPermissions = {
            "users": {
                "demo@bigbola.com": {
                    "dashboards": ["principal"]
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar mensaje de carga
            showStatus('Cargando permisos...', 'loading');
            
            // Cargar permisos desde el JSON usando CORS proxy
            loadPermissions();
            
            // Configurar evento de login
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.addEventListener('click', handleLogin);
            
            // Permitir login con Enter
            const emailInput = document.getElementById('email');
            emailInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        });

        // Función para mostrar mensajes de estado
        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = 'status-message';
            
            if (type === 'success') {
                statusElement.classList.add('status-success');
            } else if (type === 'error') {
                statusElement.classList.add('status-error');
            } else if (type === 'loading') {
                statusElement.classList.add('status-loading');
            }
            
            statusElement.style.display = 'block';
        }

        // Función para ocultar mensajes de estado
        function hideStatus() {
            document.getElementById('statusMessage').style.display = 'none';
        }

        // Función para cargar los permisos desde el JSON usando diferentes métodos
        async function loadPermissions() {
            const jsonUrl = 'https://franciscozamoramx.github.io/centro-dashboards/PERMISSION_FILES_BI/permissions.json';
            
            // Método 1: Intentar con fetch directo
            try {
                console.log('Intentando cargar permisos directamente...');
                const response = await fetch(jsonUrl + '?t=' + new Date().getTime());
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                permissionsData = data;
                console.log('Permisos cargados correctamente (método directo)');
                showStatus('Permisos cargados correctamente', 'success');
                setTimeout(hideStatus, 2000);
                return;
            } catch (error) {
                console.log('Método directo falló:', error.message);
            }
            
            // Método 2: Usar CORS proxy
            try {
                console.log('Intentando cargar permisos con CORS proxy...');
                // Usar un proxy CORS público
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const response = await fetch(proxyUrl + jsonUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                permissionsData = data;
                console.log('Permisos cargados correctamente (método proxy)');
                showStatus('Permisos cargados correctamente', 'success');
                setTimeout(hideStatus, 2000);
                return;
            } catch (error) {
                console.log('Método proxy falló:', error.message);
            }
            
            // Método 3: Usar JSONP alternativo
            try {
                console.log('Intentando cargar permisos con JSONP alternativo...');
                await loadWithJSONP();
                return;
            } catch (error) {
                console.log('Método JSONP falló:', error.message);
            }
            
            // Si todos los métodos fallan, usar permisos por defecto
            console.log('Todos los métodos fallaron, usando permisos por defecto');
            permissionsData = defaultPermissions;
            showStatus('Usando permisos por defecto (problema de CORS)', 'error');
        }

        // Método alternativo usando JSONP
        function loadWithJSONP() {
            return new Promise((resolve, reject) => {
                // Crear un script element para JSONP
                const script = document.createElement('script');
                script.src = 'https://franciscozamoramx.github.io/centro-dashboards/PERMISSION_FILES_BI/permissions.json?callback=handleJSONP';
                script.onerror = reject;
                
                // Función global para manejar la respuesta JSONP
                window.handleJSONP = function(data) {
                    permissionsData = data;
                    console.log('Permisos cargados correctamente (método JSONP)');
                    showStatus('Permisos cargados correctamente', 'success');
                    setTimeout(hideStatus, 2000);
                    document.head.removeChild(script);
                    delete window.handleJSONP;
                    resolve(data);
                };
                
                document.head.appendChild(script);
                
                // Timeout después de 5 segundos
                setTimeout(() => {
                    document.head.removeChild(script);
                    delete window.handleJSONP;
                    reject(new Error('Timeout cargando JSONP'));
                }, 5000);
            });
        }

        // Función para manejar el login
        function handleLogin() {
            const email = document.getElementById('email').value.trim().toLowerCase();
            
            if (!email) {
                showStatus('Por favor ingresa tu correo electrónico', 'error');
                return;
            }
            
            if (!permissionsData) {
                showStatus('Error: Los permisos no se han cargado correctamente. Intenta nuevamente.', 'error');
                return;
            }
            
            // Verificar si el usuario existe en los permisos
            if (permissionsData.users && permissionsData.users[email]) {
                currentUser = email;
                currentUserPermissions = permissionsData.users[email].dashboards || [];
                
                // Mostrar información del usuario
                document.getElementById('userEmail').textContent = email;
                document.getElementById('dashboardsCount').textContent = currentUserPermissions.length;
                document.getElementById('userInfo').style.display = 'block';
                
                hideStatus();
                
                // Ocultar login y mostrar welcome
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('welcomeContainer').style.display = 'block';
                
                // Iniciar la cuenta regresiva
                startCountdown();
            } else {
                showStatus('No tienes permisos para acceder al Centro de BI o el correo no está registrado.', 'error');
            }
        }

        // Detectar si es dispositivo móvil/tableta
        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || 
                   (navigator.userAgent.indexOf('IEMobile') !== -1) ||
                   (window.innerWidth <= 1024);
        }
        
        // Si es móvil/tableta, ocultar welcome y mostrar dashboard móvil
        function initMobileDashboard() {
            document.getElementById('welcomeContainer').style.display = 'none';
            document.getElementById('mobileDashboardContainer').style.display = 'block';
            
            // Actualizar información del usuario en móvil
            document.getElementById('mobileUserEmail').textContent = currentUser;
            
            // Generar menú basado en permisos
            generateMobileMenu();
            
            // Inicializar funcionalidad del dashboard móvil
            initMobileDashboardFunctionality();
        }
        
        // Generar menú móvil basado en permisos
        function generateMobileMenu() {
            const mobileSidebar = document.getElementById('mobileSidebar');
            
            // Limpiar menú existente (excepto el header)
            const existingMenuItems = mobileSidebar.querySelectorAll('.mobile-menu-section, .mobile-menu-item, .mobile-sidebar-footer');
            existingMenuItems.forEach(item => item.remove());
            
            // Agregar dashboard principal si está permitido
            if (currentUserPermissions.includes('principal')) {
                const principalBtn = document.createElement('button');
                principalBtn.className = 'mobile-menu-item active';
                principalBtn.setAttribute('data-src', dashboardUrls.principal);
                principalBtn.innerHTML = `<i class="${dashboardIcons.principal}"></i> ${dashboardNames.principal}`;
                mobileSidebar.appendChild(principalBtn);
            }
            
            // Agregar sección de Dashboards si hay más de un dashboard
            const otherDashboards = currentUserPermissions.filter(d => d !== 'principal' && d !== 'diccionario');
            if (otherDashboards.length > 0) {
                const dashboardsSection = document.createElement('div');
                dashboardsSection.className = 'mobile-menu-section';
                dashboardsSection.textContent = 'Dashboards';
                mobileSidebar.appendChild(dashboardsSection);
                
                // Agregar cada dashboard permitido
                otherDashboards.forEach(dashboard => {
                    if (dashboardUrls[dashboard]) {
                        const menuItem = document.createElement('button');
                        menuItem.className = 'mobile-menu-item';
                        menuItem.setAttribute('data-src', dashboardUrls[dashboard]);
                        menuItem.innerHTML = `<i class="${dashboardIcons[dashboard]}"></i> ${dashboardNames[dashboard]}`;
                        mobileSidebar.appendChild(menuItem);
                    }
                });
            }
            
            // Agregar sección de Herramientas
            const toolsSection = document.createElement('div');
            toolsSection.className = 'mobile-menu-section';
            toolsSection.textContent = 'Herramientas';
            mobileSidebar.appendChild(toolsSection);
            
            // Agregar Diccionario KPI's si está permitido
            if (currentUserPermissions.includes('diccionario')) {
                const diccionarioBtn = document.createElement('button');
                diccionarioBtn.className = 'mobile-menu-item';
                diccionarioBtn.setAttribute('data-src', dashboardUrls.diccionario);
                diccionarioBtn.innerHTML = `<i class="${dashboardIcons.diccionario}"></i> ${dashboardNames.diccionario}`;
                mobileSidebar.appendChild(diccionarioBtn);
            }
            
            // Agregar botón de Ayuda
            const whatsappBtn = document.createElement('button');
            whatsappBtn.className = 'mobile-menu-item';
            whatsappBtn.id = 'mobileWhatsappBtn';
            whatsappBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Ayuda';
            mobileSidebar.appendChild(whatsappBtn);
            
            // Agregar footer con botón de salir
            const footer = document.createElement('div');
            footer.className = 'mobile-sidebar-footer';
            const exitBtn = document.createElement('button');
            exitBtn.className = 'mobile-exit-btn';
            exitBtn.id = 'mobileExitBtn';
            exitBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Salir';
            footer.appendChild(exitBtn);
            mobileSidebar.appendChild(footer);
            
            // Cargar el primer dashboard permitido
            const firstDashboard = currentUserPermissions.includes('principal') ? 'principal' : currentUserPermissions[0];
            if (dashboardUrls[firstDashboard]) {
                document.getElementById('mobileIframe').src = dashboardUrls[firstDashboard];
            }
        }
        
        // Inicializar funcionalidad del dashboard móvil
        function initMobileDashboardFunctionality() {
            const mobileToggleBtn = document.getElementById('mobileToggleBtn');
            const mobileSidebar = document.getElementById('mobileSidebar');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const mobileIframeContainer = document.getElementById('mobileIframeContainer');
            const mobileIframe = document.getElementById('mobileIframe');
            const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');
            const mobileWhatsappBtn = document.getElementById('mobileWhatsappBtn');
            const mobileExitBtn = document.getElementById('mobileExitBtn');
            
            let isSidebarOpen = false;
            
            // Función para abrir WhatsApp
            function openWhatsApp() {
                const phoneNumber = '+524421974414';
                const message = 'Hola, necesito ayuda en el Centro de Business Intelligence';
                const url = 'https://wa.me/' + phoneNumber + '?text=' + encodeURIComponent(message);
                window.open(url, '_blank');
            }
            
            // Función para toggle del sidebar
            function toggleSidebar() {
                isSidebarOpen = !isSidebarOpen;
                mobileSidebar.classList.toggle('active');
                mobileOverlay.classList.toggle('active');
                mobileIframeContainer.classList.toggle('sidebar-open');
                
                // Cambiar el ícono según el estado
                if (isSidebarOpen) {
                    mobileToggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                } else {
                    mobileToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                }
            }
            
            // Evento para el botón de toggle
            mobileToggleBtn.addEventListener('click', toggleSidebar);
            
            // Evento para el overlay
            mobileOverlay.addEventListener('click', toggleSidebar);
            
            // Eventos para los items del menú
            mobileMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const dashboardUrl = this.getAttribute('data-src');
                    
                    if (dashboardUrl) {
                        // Remover active de todos los items
                        mobileMenuItems.forEach(menuItem => {
                            menuItem.classList.remove('active');
                        });
                        
                        // Agregar active al item clickeado
                        this.classList.add('active');
                        
                        // Cargar el dashboard en el iframe
                        mobileIframe.src = dashboardUrl;
                        
                        // Cerrar el sidebar después de seleccionar
                        if (isSidebarOpen) {
                            toggleSidebar();
                        }
                    }
                });
            });
            
            // Evento para el botón de WhatsApp
            mobileWhatsappBtn.addEventListener('click', function() {
                openWhatsApp();
            });
            
            // Evento para el botón de salir
            mobileExitBtn.addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres salir del Centro de BI?')) {
                    // Regresar al login
                    document.getElementById('mobileDashboardContainer').style.display = 'none';
                    document.getElementById('loginContainer').style.display = 'block';
                    document.getElementById('email').value = '';
                    currentUser = null;
                    currentUserPermissions = [];
                }
            });
        }

        // Código para PC/Laptop
        const openBtn = document.getElementById('openBtn');
        const countdownEl = document.getElementById('countdown');
        
        let count = 5;
        let countdownInterval;
        let popupBlocked = false;
        
        // Función para iniciar la cuenta regresiva
        function startCountdown() {
            // Si es móvil, inicializar dashboard móvil
            if (isMobileDevice()) {
                initMobileDashboard();
                return;
            }
            
            countdownInterval = setInterval(function() {
                count--;
                countdownEl.textContent = count;
                
                if (count <= 0) {
                    clearInterval(countdownInterval);
                    openDashboard();
                }
            }, 1000);
        }
        
        // Función para abrir el dashboard en pantalla completa
        function openDashboard() {
            // Generar HTML del dashboard con permisos
            const dashboardHTML = generateDashboardHTML();
            
            // Abrir la ventana del dashboard maximizada
            const dashboardWindow = window.open('', '_blank', 'width=' + screen.width + ',height=' + screen.height + ',left=0,top=0,fullscreen=yes');
            
            if (dashboardWindow) {
                dashboardWindow.document.write(dashboardHTML);
                dashboardWindow.document.close();
                dashboardWindow.focus();
                popupBlocked = false;
            } else {
                popupBlocked = true;
                openBtn.style.display = 'inline-block';
                addCountdownToButton(5);
            }
        }
        
        // Función para generar el HTML del dashboard con permisos
        function generateDashboardHTML() {
            // Generar elementos del menú basados en permisos
            let menuItemsHTML = '';
            
            // Dashboard principal
            if (currentUserPermissions.includes('principal')) {
                menuItemsHTML += `
                    <button class="menu-item active" data-src="${dashboardUrls.principal}">
                        <i class="${dashboardIcons.principal}"></i> ${dashboardNames.principal}
                    </button>
                `;
            }
            
            // Otros dashboards
            const otherDashboards = currentUserPermissions.filter(d => d !== 'principal' && d !== 'diccionario');
            if (otherDashboards.length > 0) {
                menuItemsHTML += `<div class="menu-section">Dashboards</div>`;
                
                otherDashboards.forEach(dashboard => {
                    if (dashboardUrls[dashboard]) {
                        menuItemsHTML += `
                            <button class="menu-item" data-src="${dashboardUrls[dashboard]}">
                                <i class="${dashboardIcons[dashboard]}"></i> ${dashboardNames[dashboard]}
                            </button>
                        `;
                    }
                });
            }
            
            // Herramientas
            menuItemsHTML += `<div class="menu-section">Herramientas</div>`;
            
            // Diccionario KPI's
            if (currentUserPermissions.includes('diccionario')) {
                menuItemsHTML += `
                    <button class="menu-item" data-src="${dashboardUrls.diccionario}">
                        <i class="${dashboardIcons.diccionario}"></i> ${dashboardNames.diccionario}
                    </button>
                `;
            }
            
            // Botón de ayuda
            menuItemsHTML += `
                <button class="menu-item" id="whatsappBtn">
                    <i class="fab fa-whatsapp"></i> Ayuda
                </button>
            `;
            
            // Determinar el dashboard inicial
            let initialDashboard = dashboardUrls.principal; // Por defecto
            if (currentUserPermissions.includes('principal')) {
                initialDashboard = dashboardUrls.principal;
            } else if (currentUserPermissions.length > 0) {
                initialDashboard = dashboardUrls[currentUserPermissions[0]] || dashboardUrls.principal;
            }
            
            return `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Business Intelligence de Big Bola Casinos</title>
                    <link rel="icon" type="image/png" href="https://i.postimg.cc/QCN4dPG1/analisis-de-datos.png">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        }
                        
                        body {
                            background-color: #f5f5f5;
                            overflow: hidden;
                            margin: 0;
                            padding: 0;
                        }
                        
                        .container {
                            width: 100vw;
                            height: 100vh;
                            background-color: #fff;
                            display: flex;
                            flex-direction: column;
                            position: relative;
                        }
                        
                        .floating-toggle {
                            position: fixed;
                            top: 20px;
                            left: 20px;
                            width: 50px;
                            height: 50px;
                            background: rgba(26, 58, 143, 0.8);
                            color: white;
                            border: none;
                            border-radius: 50%;
                            cursor: pointer;
                            z-index: 1001;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 20px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            transition: all 0.3s ease;
                        }
                        
                        .floating-toggle:hover {
                            background: rgba(26, 58, 143, 0.9);
                            transform: scale(1.05);
                        }
                        
                        .sidebar {
                            position: fixed;
                            top: 0;
                            left: -320px;
                            width: 320px;
                            height: 100vh;
                            background: #152c6e;
                            z-index: 1002;
                            transition: left 0.3s ease;
                            overflow-y: auto;
                            padding: 20px;
                            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
                            display: flex;
                            flex-direction: column;
                        }
                        
                        .sidebar.active {
                            left: 0;
                        }
                        
                        .sidebar-overlay {
                            display: none;
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0,0,0,0.5);
                            z-index: 1001;
                        }
                        
                        .sidebar-overlay.active {
                            display: block;
                        }
                        
                        .sidebar-header {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            padding: 20px 0;
                            border-bottom: 1px solid rgba(255,255,255,0.2);
                            margin-bottom: 20px;
                        }
                        
                        .sidebar-logo {
                            height: 60px;
                            width: auto;
                            margin-bottom: 15px;
                        }
                        
                        .sidebar-title {
                            font-size: 18px;
                            font-weight: bold;
                            color: white;
                            text-align: center;
                            line-height: 1.2;
                        }
                        
                        .user-info {
                            margin-top: 10px;
                            font-size: 12px;
                            color: #FFD700;
                            text-align: center;
                        }
                        
                        .menu-section {
                            color: #FFD700;
                            font-weight: bold;
                            margin: 20px 0 10px;
                            padding-bottom: 5px;
                            border-bottom: 1px solid rgba(255,255,255,0.2);
                            font-size: 16px;
                        }
                        
                        .menu-item {
                            display: block;
                            width: 100%;
                            padding: 12px 15px;
                            margin-bottom: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            border: none;
                            border-radius: 5px;
                            text-align: left;
                            cursor: pointer;
                            transition: background 0.3s;
                            font-size: 15px;
                        }
                        
                        .menu-item:hover {
                            background: rgba(255,255,255,0.2);
                        }
                        
                        .menu-item.active {
                            background: rgba(255,215,0,0.3);
                            border-left: 3px solid #FFD700;
                        }
                        
                        .menu-item i {
                            margin-right: 10px;
                            width: 20px;
                            text-align: center;
                        }
                        
                        .sidebar-footer {
                            margin-top: auto;
                            padding-top: 20px;
                            border-top: 1px solid rgba(255,255,255,0.2);
                        }
                        
                        .exit-btn {
                            display: block;
                            width: 100%;
                            padding: 12px 15px;
                            background: rgba(255, 0, 0, 0.2);
                            color: white;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 15px;
                            transition: background 0.3s;
                            text-align: center;
                        }
                        
                        .exit-btn:hover {
                            background: rgba(255, 0, 0, 0.3);
                        }
                        
                        .iframe-container {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: white;
                            transition: left 0.3s ease;
                        }
                        
                        .iframe-container.sidebar-open {
                            left: 320px;
                            width: calc(100% - 320px);
                        }
                        
                        iframe {
                            width: 100%;
                            height: 100%;
                            border: none;
                        }
                        
                        /* Overlay solo para click derecho */
                        .right-click-blocker {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: 999;
                            /* Solo reacciona al click derecho */
                            pointer-events: none;
                        }
                        
                        .right-click-blocker.active {
                            pointer-events: auto;
                            background: transparent;
                        }
                        
                        /* Estilo para el mensaje de menú deshabilitado */
                        .context-menu-message {
                            position: fixed;
                            top: 10px;
                            right: 10px;
                            background: rgba(0,0,0,0.7);
                            color: white;
                            padding: 10px;
                            border-radius: 5px;
                            z-index: 10000;
                            font-size: 14px;
                            display: none;
                        }
                    </style>
                </head>
                <body>
                    <div class="context-menu-message" id="contextMenuMessage">Menú contextual deshabilitado</div>
                    <div class="container">
                        <button class="floating-toggle" id="toggleBtn">
                            <i class="fas fa-bars"></i>
                        </button>
                        
                        <div class="sidebar-overlay" id="overlay"></div>
                        
                        <div class="sidebar" id="sidebar">
                            <div class="sidebar-header">
                                <img src="https://i.postimg.cc/hGqNYsNp/Isotipo-Perfiles-Marmol01-Photoroom.png" alt="Big Bola Casinos" class="sidebar-logo">
                                <div class="sidebar-title">
                                    <div>Centro de</div>
                                    <div>Business Intelligence</div>
                                </div>
                                <div class="user-info">
                                    Usuario: ${currentUser}
                                </div>
                            </div>
                            
                            ${menuItemsHTML}
                            
                            <div class="sidebar-footer">
                                <button class="exit-btn" onclick="window.close()">
                                    <i class="fas fa-sign-out-alt"></i> Salir
                                </button>
                            </div>
                        </div>
                        
                        <div class="iframe-container" id="iframeContainer">
                            <div class="right-click-blocker" id="rightClickBlocker"></div>
                            <iframe id="dashboardFrame" src="${initialDashboard}"></iframe>
                        </div>
                    </div>

                    <script>
                        // Deshabilitar clic derecho en la ventana del dashboard
                        document.addEventListener('contextmenu', function(e) {
                            e.preventDefault();
                            const message = document.getElementById('contextMenuMessage');
                            message.style.display = 'block';
                            setTimeout(() => {
                                message.style.display = 'none';
                            }, 2000);
                        });

                        document.addEventListener('DOMContentLoaded', function() {
                            const toggleBtn = document.getElementById('toggleBtn');
                            const sidebar = document.getElementById('sidebar');
                            const overlay = document.getElementById('overlay');
                            const iframeContainer = document.getElementById('iframeContainer');
                            const menuItems = document.querySelectorAll('.menu-item');
                            const whatsappBtn = document.getElementById('whatsappBtn');
                            const iframe = document.getElementById('dashboardFrame');
                            
                            let isSidebarOpen = false;
                            
                            // Función para abrir WhatsApp
                            function openWhatsApp() {
                                const phoneNumber = '+524421974414';
                                const message = 'Hola, necesito ayuda en el Centro de Business Intelligence';
                                const url = 'https://wa.me/' + phoneNumber + '?text=' + encodeURIComponent(message);
                                window.open(url, '_blank');
                            }
                            
                            // Función para toggle del sidebar
                            function toggleSidebar() {
                                isSidebarOpen = !isSidebarOpen;
                                sidebar.classList.toggle('active');
                                overlay.classList.toggle('active');
                                iframeContainer.classList.toggle('sidebar-open');
                                
                                // Cambiar el ícono según el estado
                                if (isSidebarOpen) {
                                    toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                                } else {
                                    toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                                }
                            }
                            
                            // Evento para el botón de toggle
                            toggleBtn.addEventListener('click', toggleSidebar);
                            
                            // Evento para el overlay
                            overlay.addEventListener('click', toggleSidebar);
                            
                            // Eventos para los items del menú
                            menuItems.forEach(item => {
                                item.addEventListener('click', function() {
                                    const dashboardUrl = this.getAttribute('data-src');
                                    
                                    if (dashboardUrl) {
                                        // Remover active de todos los items
                                        menuItems.forEach(menuItem => {
                                            menuItem.classList.remove('active');
                                        });
                                        
                                        // Agregar active al item clickeado
                                        this.classList.add('active');
                                        
                                        // Cargar el dashboard en el iframe
                                        iframe.src = dashboardUrl;
                                        
                                        // Cerrar el sidebar después de seleccionar
                                        if (isSidebarOpen) {
                                            toggleSidebar();
                                        }
                                    }
                                });
                            });
                            
                            // Evento para el botón de WhatsApp
                            whatsappBtn.addEventListener('click', function() {
                                openWhatsApp();
                            });
                            
                            // Pantalla completa
                            setTimeout(function() {
                                if (document.documentElement.requestFullscreen) {
                                    document.documentElement.requestFullscreen();
                                }
                            }, 100);
                        });
                    <\/script>
                </body>
                </html>
            `;
        }
        
        // Función para crear un contador en el botón
        function addCountdownToButton(seconds) {
            // Crear el badge para el contador
            const badge = document.createElement('span');
            badge.className = 'countdown-badge';
            badge.textContent = seconds;
            openBtn.appendChild(badge);
            
            // Deshabilitar el botón temporalmente
            openBtn.disabled = false;
            
            let countdown = seconds;
            const buttonCountdown = setInterval(function() {
                countdown--;
                badge.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(buttonCountdown);
                    badge.remove();
                    openBtn.disabled = false;
                    
                    // Si la ventana fue bloqueada, activar el botón automáticamente
                    if (popupBlocked) {
                        openDashboard();
                    }
                }
            }, 1000);
        }
        
        // Evento para el botón de abrir
        openBtn.addEventListener('click', function() {
            clearInterval(countdownInterval);
            openDashboard();
        });
    </script>
</body>
</html>