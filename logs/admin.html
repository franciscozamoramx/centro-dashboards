<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Logs de Acceso BI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* [TODOS LOS ESTILOS SE MANTIENEN IGUAL - NO CAMBIAR] */
        /* ... todo el CSS original ... */
    </style>
</head>
<body>
    <!-- [TODO EL HTML SE MANTIENE IGUAL - NO CAMBIAR] -->
    <!-- ... todo el HTML original ... -->
    
    <script>
        // ==================== VARIABLES GLOBALES ====================
        let allLogs = [];
        let filteredLogs = [];
        let currentPage = 1;
        const logsPerPage = 50;
        let charts = {};
        let autoRefreshInterval = null;
        
        // ✅✅✅ SOLUCIÓN PERMANENTE - LÍNEA CRÍTICA 1 ✅✅✅
        window.allLogs = allLogs; // Exponer globalmente desde el inicio
        
        // Configuración GitHub
        const GITHUB_CONFIG = {
            owner: 'franciscozamoramx',
            repo: 'centro-dashboards',
            branch: 'main',
            token: localStorage.getItem('github_pat_token') || ''
        };
        
        // URLs - CORREGIDA para usar ruta relativa desde /logs/
        const LOGS_URL = '../logs/logs.json'; // ← Cambiado a relativa
        const GITHUB_REPO_URL = 'https://github.com/franciscozamoramx/centro-dashboards';
        
        // [EL RESTO DEL CÓDIGO SE MANTIENE IGUAL HASTA...]
        
        // En la función loadLogs(), después de cargar los logs:
        async function loadLogs() {
            try {
                // ... código existente ...
                
                allLogs = logs.reverse(); // Más recientes primero
                
                // ✅✅✅ SOLUCIÓN PERMANENTE - LÍNEA CRÍTICA 2 ✅✅✅
                window.allLogs = allLogs; // Actualizar variable global
                
                console.log('✅ Logs cargados:', allLogs.length);
                console.log('✅ window.allLogs disponible con', window.allLogs.length, 'logs');
                
                // ... resto del código ...
            } catch (error) {
                // ... manejo de errores ...
            }
        }
        
        // En la función viewLocalLogs():
        function viewLocalLogs() {
            try {
                const localLogs = JSON.parse(localStorage.getItem('bi_logs_local') || '[]');
                const pendingLogs = JSON.parse(localStorage.getItem('bi_logs_pending') || '[]');
                
                allLogs = [...localLogs, ...pendingLogs].sort((a, b) => 
                    new Date(b.timestamp) - new Date(a.timestamp)
                );
                
                // ✅✅✅ SOLUCIÓN PERMANENTE - LÍNEA CRÍTICA 3 ✅✅✅
                window.allLogs = allLogs; // Actualizar variable global
                
                // ... resto del código ...
            } catch (error) {
                // ... manejo de errores ...
            }
        }
        
        // [EL RESTO DEL CÓDIGO SE MANTIENE IGUAL]
        
        // Al final, en la inicialización:
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Admin panel inicializado desde /logs/admin.html');
            console.log('✅ window.allLogs definida:', window.allLogs ? 'SÍ' : 'NO');
            
            // Cargar logs al iniciar
            loadLogs();
            
            // ... resto de inicialización ...
        });
    </script>
</body>
</html>
